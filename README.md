# Winnic

Небольшое Windows‑приложение (WinForms, .NET 9) для работы из системного трея, которое помогает управлять текущим активным окном:
- центрирует активное окно по рабочей области монитора;
- разворачивает активное окно на весь экран;
- восстанавливает предыдущее положение/размер активного окна;
- позволяет настраивать горячие клавиши и автозапуск через окно настроек.

## Возможности

- Центрирование активного окна: по умолчанию `Ctrl + Alt + C`.
- Разворот активного окна на весь экран: по умолчанию `Ctrl + Alt + Enter`.
- Восстановление последнего положения активного окна: по умолчанию `Ctrl + Alt + Backspace`.
- Иконка в трее с меню: "Настройки…" и "Выход".
- Автозапуск при входе в систему (вкл/выкл в настройках).

## Архитектура и структура

- `Program.cs` - точка входа, запускает контекст трея.
- `TrayApplicationContext.cs` - логика иконки в трее, контекстное меню, обработка хоткеев, применение настроек и автозапуска.
- `WindowService.cs` (`WindowCenterService`) - операции с активным окном: центрирование, разворот, сохранение и восстановление положения (WinAPI: `user32.dll`).
- `HotkeyManager.cs` - регистрация/снятие глобальных горячих клавиш (WinAPI `RegisterHotKey`), диспетчеризация колбэков.
- `SettingsForm.cs` - окно настроек: выбор модификаторов и клавиш для трёх действий, флаг автозапуска.
- `SettingsService.cs` - чтение/запись настроек в `%LocalAppData%/Winnic/settings.json` (System.Text.Json).
- `Settings.cs` - модель настроек `AppSettings` (хранит хоткеи и флаг автозапуска).
- `AutoStartService.cs` - включение/отключение автозапуска через реестр `HKCU\Software\Microsoft\Windows\CurrentVersion\Run`.
- `IconFactory.cs` - генерация простой иконки приложения на лету.
- `Winnic.csproj` - проект .NET 9 Windows Forms, `app.manifest` - манифест приложения.

Особенности:
- Работает только на Windows (используются WinAPI и Windows Forms).
- Требует права на регистрацию глобальных хоткеев (обычно достаточно обычного пользователя).
- При первом запуске создаёт каталог `%LocalAppData%/Winnic` и файл `settings.json`.

## Зависимости

Среда и SDK:
- **.NET SDK 9.0** (Windows) с поддержкой `net9.0-windows` и Windows Forms.
- ОС **Windows 10/11**. На WSL/ Linux приложение не запускается (только сборка в кросс-режиме)
  не поддерживается, т.к. таргет - WinExe с WinAPI.

NuGet-пакеты: внешние пакеты не используются; применяется стандартная библиотека .NET и P/Invoke к `user32.dll`.

## Сборка и запуск локально

1. Установите .NET SDK 9.0 на Windows.
2. В командной строке откройте каталог проекта:
   ```bash
   cd path\to\winnic
   ```
3. Восстановите (опционально) и соберите релиз:
   ```bash
   dotnet build -c Release
   ```
4. Запустите приложение:
   ```bash
   dotnet run -c Release
   ```

Альтернативно, можно опубликовать самодостаточный билд:
```bash
dotnet publish -c Release -r win-x64 --self-contained true /p:PublishSingleFile=true
```
Готовый исполняемый файл будет в `bin/Release/net9.0-windows/win-x64/publish/`.

## Настройка горячих клавиш

Откройте меню иконки в трее → "Настройки…" и задайте сочетания для:
- Центрирования окна
- Разворота окна
- Восстановления предыдущего положения

По умолчанию модификатор `Alt` обязателен для восстановления. При конфликте регистрации хоткея приложение покажет уведомление.

## Автозапуск

Опция "Автозапуск" управляет ключом в `HKCU/Software/Microsoft/Windows/CurrentVersion/Run`. При включении туда записывается путь к текущему исполняемому файлу.

## Трайбл-ноутс разработчика

- Регистрация хоткеев: `HotkeyManager.Register` выбрасывает исключение при неудаче (например, если сочетание занято). Обработчики показывают балун с текстом ошибки.
- Центрирование и работа с мониторами: используется `MonitorFromWindow`/`GetMonitorInfo` с фолбэком на `Screen.FromHandle`.
- Восстановление положения: сохраняется `WINDOWPLACEMENT` активного окна, далее применяется через `SetWindowPlacement` с резервом `ShowWindow(SW_SHOWNORMAL)`.
- Настройки сериализуются JSON с `JsonStringEnumConverter` для `System.Windows.Forms.Keys`.

## Известные ограничения

- Взаимодействие с UWP/защищёнными окнами может быть ограничено.
- Приложения, запущенные от имени администратора, могут требовать повышенных прав для корректной работы хоткеев.
- Не предназначено для многооконных сценариев привязки за один хоткей; работает только с текущим активным окном.

## Лицензия

Проект распространяется по лицензии MIT. Полный текст см. в файле LICENSE.txt.


